<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>F1-Inspired Streetwear eCommerce Prototype</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Custom Scrollbar for better UX */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    ::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
    /* Toast / Notification */
    #toast {
      transition: all 0.3s ease;
    }
  </style>
</head>
<body class="bg-gray-100 font-sans min-h-screen flex flex-col">

  <!-- Navigation Header -->
  <header class="bg-black text-white flex justify-between items-center px-6 py-4 shadow-md sticky top-0 z-20">
    <h1 class="font-extrabold tracking-wider text-xl cursor-pointer" role="link" tabindex="0" id="nav-home">F1 Streetwear</h1>
    <nav class="flex items-center space-x-4">
      <button id="nav-category" class="hover:underline focus:underline focus:outline-none">Category</button>
      <button id="nav-cart" aria-label="View Cart" class="relative focus:outline-none">
        Cart
        <span id="cart-count" class="absolute -top-2 -right-5 bg-red-600 px-1 rounded text-xs font-bold">0</span>
      </button>
      <button id="nav-login" class="hover:underline focus:underline focus:outline-none">Login</button>
    </nav>
  </header>

  <!-- Main content container -->
  <main class="flex-grow container mx-auto p-4 max-w-6xl" id="main-content" role="main" tabindex="-1">

    <!-- Home Page -->
    <section id="home-page" class="">
      <!-- Hero Section -->
      <section class="bg-gradient-to-r from-red-700 to-gray-900 rounded-lg p-12 text-white mb-10 text-center select-none" aria-label="Hero section with brand message and call to action">
        <h2 class="text-4xl font-extrabold mb-4">Fast Lane Streetwear Inspired by Formula 1</h2>
        <p class="text-lg max-w-xl mx-auto mb-6 leading-relaxed">Harness speed, style, and adrenaline with exclusive F1-inspired apparel designed for the street and the track.</p>
        <button id="view-products-btn" class="bg-white text-black font-bold py-3 px-6 rounded shadow-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-red-400" aria-label="View all products">View All Products</button>
      </section>

      <!-- Category Section -->
      <section aria-labelledby="category-section-title" class="mb-12">
        <h3 id="category-section-title" class="text-2xl font-semibold mb-6">Shop by Category</h3>
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-6 select-none" role="list">
          <button role="listitem" data-category="tees" class="category-card bg-white rounded-lg shadow-md p-4 flex flex-col items-center cursor-pointer hover:shadow-lg focus:shadow-lg focus:outline-none" tabindex="0" aria-label="Tees category. Click to enter tees category page.">
            <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/83c31d9e-93cd-407c-8bc0-952f4057d427.png" alt="Red and black F1-inspired graphic t-shirt displayed on flat surface" class="w-full h-auto rounded mb-2" onerror="this.onerror=null;this.src='https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/ed5f5309-3e33-4097-8e07-4ca427bddeb8.png';" />
            <span class="mt-auto font-semibold">Tees</span>
          </button>
          <button role="listitem" data-category="jackets" class="category-card bg-white rounded-lg shadow-md p-4 flex flex-col items-center cursor-not-allowed opacity-70" aria-disabled="true" tabindex="-1" aria-label="Jackets category. Placeholder. Not yet functional.">
            <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/6c552e92-0b8a-4a04-9798-2acc16f10aad.png" alt="Black racing style streetwear jacket with red stripes" class="w-full h-auto rounded mb-2" onerror="this.onerror=null;this.src='https://placehold.co/200x200?text=Image+Unavailable';" />
            <span class="mt-auto font-semibold">Jackets</span>
          </button>
          <button role="listitem" data-category="caps" class="category-card bg-white rounded-lg shadow-md p-4 flex flex-col items-center cursor-not-allowed opacity-70" aria-disabled="true" tabindex="-1" aria-label="Caps category. Placeholder. Not yet functional.">
            <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/7832b726-fb02-4ccf-ad1e-852d84abed4e.png" alt="Stylish red and black baseball cap with F1 logo" class="w-full h-auto rounded mb-2" onerror="this.onerror=null;this.src='https://placehold.co/200x200?text=Image+Unavailable';" />
            <span class="mt-auto font-semibold">Caps</span>
          </button>
          <button role="listitem" data-category="accessories" class="category-card bg-white rounded-lg shadow-md p-4 flex flex-col items-center cursor-not-allowed opacity-70" aria-disabled="true" tabindex="-1" aria-label="Accessories category. Placeholder. Not yet functional.">
            <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/9d09e70b-ee4c-4c76-b0ca-5b465b9e5dd4.png" alt="Sleek black F1-inspired keychain and wristband displayed neatly" class="w-full h-auto rounded mb-2" onerror="this.onerror=null;this.src='https://placehold.co/200x200?text=Image+Unavailable';" />
            <span class="mt-auto font-semibold">Accessories</span>
          </button>
          <button role="listitem" data-category="limited" class="category-card bg-white rounded-lg shadow-md p-4 flex flex-col items-center cursor-not-allowed opacity-70" aria-disabled="true" tabindex="-1" aria-label="Limited category. Placeholder. Not yet functional.">
            <img src="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/a7610216-194a-4c62-b983-5ae6d1861fa2.png" alt="Stylized limited edition F1-inspired merchandise box with red accent" class="w-full h-auto rounded mb-2" onerror="this.onerror=null;this.src='https://placehold.co/200x200?text=Image+Unavailable';" />
            <span class="mt-auto font-semibold">Limited</span>
          </button>
        </div>
      </section>
    </section>

    <!-- Category Page -->
    <section id="category-page" class="hidden" aria-label="Category products page">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-3xl font-bold" id="category-name-title" tabindex="0"></h2>
        <button id="category-back-btn" class="text-red-600 font-semibold hover:underline focus:outline-none" aria-label="Go back to home page">Back</button>
      </div>
      <div class="grid gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4" id="products-grid" aria-live="polite" aria-relevant="additions removals"></div>
    </section>

    <!-- Product Page -->
    <section id="product-page" class="hidden" aria-label="Single product detail page">
      <button id="product-back-btn" class="mb-4 text-red-600 font-semibold hover:underline focus:outline-none" aria-label="Back to category page">← Back to Category</button>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
        <div>
          <img id="product-image" src="" alt="" class="w-full rounded-lg max-h-[400px] object-cover shadow-md" onerror="this.onerror=null;this.src='https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/3bf7cdfc-1e25-430a-a68a-3ccda21358cf.png';" />
        </div>
        <div class="flex flex-col justify-between">
          <div>
            <h2 id="product-title" class="text-3xl font-bold mb-3" tabindex="0"></h2>
            <p id="product-desc" class="mb-4 text-gray-700"></p>
            <strong class="text-xl font-semibold text-red-600" id="product-price"></strong>
          </div>

          <div class="mt-6">
            <label for="search-product" class="block text-lg font-semibold mb-2">Search Within Products:</label>
            <input type="search" id="search-product" aria-describedby="search-desc" placeholder="Search for this product's variants or features" class="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-red-500 focus:outline-none" />
            <p id="search-desc" class="text-sm text-gray-500 mt-1">Start typing to search product variants or features.</p>
            <p id="search-empty-msg" class="text-red-600 font-semibold mt-2 hidden" role="alert"></p>
          </div>

          <button id="add-to-cart-btn" class="bg-red-600 text-white rounded-md px-6 py-3 mt-8 font-bold hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500" aria-label="Add product to cart">Add to Cart</button>
        </div>
      </div>
    </section>

    <!-- Cart Page -->
    <section id="cart-page" class="hidden" aria-label="Shopping cart page">
      <h2 class="text-3xl font-bold mb-6" tabindex="0">Your Cart</h2>
      <div id="cart-list" role="list" class="space-y-4 mb-6"></div>
      <div class="flex items-center justify-between border-t pt-4">
        <strong class="text-xl">Subtotal:</strong>
        <span id="cart-subtotal" class="text-xl font-bold">€0.00</span>
      </div>
      <button id="checkout-btn" class="w-full mt-6 bg-black text-white py-3 rounded-md font-bold hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-400">Checkout</button>
      <button id="cart-back-btn" class="w-full mt-4 border border-black rounded-md py-3 font-semibold hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-400">Back to Home</button>
    </section>

    <!-- Authentication Pages Wrapper -->
    <section id="auth-wrapper" class="hidden max-w-md mx-auto bg-white rounded-lg shadow-lg p-8" aria-label="Authentication pages">
      <!-- Tabs -->
      <nav class="flex space-x-4 mb-6" role="tablist">
        <button role="tab" aria-selected="true" aria-controls="login-page" id="tab-login" class="py-2 border-b-2 border-red-600 font-semibold focus:outline-none">Login</button>
        <button role="tab" aria-selected="false" aria-controls="signup-page" id="tab-signup" class="py-2 border-b-2 border-transparent hover:border-gray-300 focus:outline-none">Sign Up</button>
        <button role="tab" aria-selected="false" aria-controls="forgot-password-page" id="tab-forgot" class="py-2 border-b-2 border-transparent hover:border-gray-300 focus:outline-none">Forgot Password</button>
      </nav>

      <!-- Login Page -->
      <form id="login-page" role="tabpanel" aria-labelledby="tab-login">
        <label for="login-email" class="block mb-2 font-semibold">Email</label>
        <input type="email" id="login-email" class="w-full mb-4 border rounded px-3 py-2 focus:ring-2 focus:ring-red-600 focus:outline-none" required />
        <label for="login-password" class="block mb-2 font-semibold">Password</label>
        <input type="password" id="login-password" class="w-full mb-6 border rounded px-3 py-2 focus:ring-2 focus:ring-red-600 focus:outline-none" required />
        <button type="submit" class="bg-red-600 text-white w-full py-3 rounded-md font-bold hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-600">Login</button>
      </form>

      <!-- Sign Up Page -->
      <form id="signup-page" role="tabpanel" aria-labelledby="tab-signup" class="hidden">
        <label for="signup-email" class="block mb-2 font-semibold">Email</label>
        <input type="email" id="signup-email" class="w-full mb-4 border rounded px-3 py-2 focus:ring-2 focus:ring-red-600 focus:outline-none" required />
        <label for="signup-password" class="block mb-2 font-semibold">Password</label>
        <input type="password" id="signup-password" class="w-full mb-4 border rounded px-3 py-2 focus:ring-2 focus:ring-red-600 focus:outline-none" required />
        <label for="signup-password2" class="block mb-2 font-semibold">Confirm Password</label>
        <input type="password" id="signup-password2" class="w-full mb-6 border rounded px-3 py-2 focus:ring-2 focus:ring-red-600 focus:outline-none" required />
        <button type="submit" class="bg-red-600 text-white w-full py-3 rounded-md font-bold hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-600">Sign Up</button>
      </form>

      <!-- Forgot Password Page -->
      <div id="forgot-password-page" role="tabpanel" aria-labelledby="tab-forgot" class="hidden space-y-4">
        <form id="forgot-email-form">
          <label for="forgot-email" class="block mb-2 font-semibold">Enter your email to receive OTP</label>
          <input type="email" id="forgot-email" class="w-full mb-4 border rounded px-3 py-2 focus:ring-2 focus:ring-red-600 focus:outline-none" required />
          <button type="submit" class="bg-red-600 text-white w-full py-3 rounded-md font-bold hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-600">Send OTP</button>
        </form>
        <form id="otp-form" class="hidden space-y-4">
          <label for="otp-input" class="block mb-2 font-semibold">Enter OTP sent via email</label>
          <input type="text" id="otp-input" maxlength="6" class="w-full mb-4 border rounded px-3 py-2 focus:ring-2 focus:ring-red-600 focus:outline-none" required />
          <button type="submit" class="bg-red-600 text-white w-full py-3 rounded-md font-bold hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-600">Verify OTP</button>
        </form>
        <form id="reset-password-form" class="hidden space-y-4">
          <label for="new-password" class="block mb-2 font-semibold">Reset your password</label>
          <input type="password" id="new-password" class="w-full mb-4 border rounded px-3 py-2 focus:ring-2 focus:ring-red-600 focus:outline-none" required />
          <label for="confirm-new-password" class="block mb-2 font-semibold">Confirm new password</label>
          <input type="password" id="confirm-new-password" class="w-full mb-6 border rounded px-3 py-2 focus:ring-2 focus:ring-red-600 focus:outline-none" required />
          <button type="submit" class="bg-red-600 text-white w-full py-3 rounded-md font-bold hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-600">Reset Password</button>
        </form>
      </div>
    </section>

  </main>

  <!-- Toast notification -->
  <div id="toast" class="fixed bottom-6 right-6 bg-black text-white rounded px-5 py-3 opacity-0 pointer-events-none z-50"></div>

  <script>
    (() => {
      // Data and State
      const categories = [
        {
          id: 'tees',
          name: 'Tees',
          description: 'F1-inspired streetwear tees - bold reds, sleek blacks, graphic prints.',
          products: [
            {
              id: 't1',
              title: 'Speed Racer Graphic Tee',
              description: 'A bold graphic tee capturing the essence of F1 speed and adrenaline.',
              price: 35.00,
              image: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/389834c2-1cbe-407f-972b-efc2235a86a7.png',
              tags: ['red', 'graphic', 'cotton', 'racing'],
            },
            {
              id: 't2',
              title: 'Pit Stop Logo Tee',
              description: 'Classic black tee featuring a pit stop inspired logo with crisp white print.',
              price: 29.99,
              image: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/9fc0770c-0d77-4225-bf72-61f9b3334d30.png',
              tags: ['black', 'logo', 'cotton'],
            },
            {
              id: 't3',
              title: 'Checkered Flag Tee',
              description: 'Iconic checkered flag design printed on high-quality fabric for race fans.',
              price: 38.50,
              image: 'https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/ee9488db-ef02-428c-ae4d-625faedd1dab.png',
              tags: ['white', 'checkered', 'cotton'],
            }
          ]
        },
        {id: 'jackets', name: 'Jackets', products: []},
        {id: 'caps', name: 'Caps', products: []},
        {id: 'accessories', name: 'Accessories', products: []},
        {id: 'limited', name: 'Limited', products: []}
      ];

      // Cart state array
      let cart = [];

      // OTP and user data tracking (simulate)
      let userOtp = null;
      let otpVerified = false;
      let userEmail = null;

      // Elements cache
      const homePage = document.getElementById('home-page');
      const categoryPage = document.getElementById('category-page');
      const productPage = document.getElementById('product-page');
      const cartPage = document.getElementById('cart-page');
      const authWrapper = document.getElementById('auth-wrapper');

      // Nav Buttons
      const navHomeBtn = document.getElementById('nav-home');
      const navCategoryBtn = document.getElementById('nav-category');
      const navCartBtn = document.getElementById('nav-cart');
      const navLoginBtn = document.getElementById('nav-login');

      // Toast
      const toast = document.getElementById('toast');

      // Home Page Category Buttons
      const categoryButtons = document.querySelectorAll('.category-card');

      // Home page product button
      const viewProductsBtn = document.getElementById('view-products-btn');

      // Category Page Title and Grid
      const categoryNameTitle = document.getElementById('category-name-title');
      const productsGrid = document.getElementById('products-grid');
      const categoryBackBtn = document.getElementById('category-back-btn');

      // Product Page elements
      const productBackBtn = document.getElementById('product-back-btn');
      const productImage = document.getElementById('product-image');
      const productTitle = document.getElementById('product-title');
      const productDesc = document.getElementById('product-desc');
      const productPrice = document.getElementById('product-price');
      const addToCartBtn = document.getElementById('add-to-cart-btn');
      const searchProductInput = document.getElementById('search-product');
      const searchEmptyMsg = document.getElementById('search-empty-msg');

      // Cart page elements
      const cartList = document.getElementById('cart-list');
      const cartSubtotal = document.getElementById('cart-subtotal');
      const checkoutBtn = document.getElementById('checkout-btn');
      const cartBackBtn = document.getElementById('cart-back-btn');
      const cartCountEl = document.getElementById('cart-count');

      // Auth tabs and forms
      const tabLogin = document.getElementById('tab-login');
      const tabSignup = document.getElementById('tab-signup');
      const tabForgot = document.getElementById('tab-forgot');
      const loginPage = document.getElementById('login-page');
      const signupPage = document.getElementById('signup-page');
      const forgotPasswordPage = document.getElementById('forgot-password-page');
      const forgotEmailForm = document.getElementById('forgot-email-form');
      const otpForm = document.getElementById('otp-form');
      const resetPasswordForm = document.getElementById('reset-password-form');

      // Current displayed product & category
      let currentCategory = null;
      let currentProduct = null;
      let filteredVariants = null;

      // Utilities
      function showToast(message, duration=3000){
        toast.textContent = message;
        toast.style.opacity = "1";
        toast.style.pointerEvents = "auto";
        setTimeout(() => {
          toast.style.opacity = "0";
          toast.style.pointerEvents = "none";
        }, duration);
      }

      function formatPrice(val){
        return '€' + val.toFixed(2);
      }

      // NAVIGATION
      function showPage(pageId) {
        // Hide all pages first
        [homePage, categoryPage, productPage, cartPage, authWrapper].forEach(page => page.classList.add('hidden'));
        // Show requested page
        switch(pageId) {
          case 'home': homePage.classList.remove('hidden'); break;
          case 'category': categoryPage.classList.remove('hidden'); break;
          case 'product': productPage.classList.remove('hidden'); break;
          case 'cart': cartPage.classList.remove('hidden'); break;
          case 'auth': authWrapper.classList.remove('hidden'); break;
        }
        // Focus main content for accessibility
        document.getElementById('main-content').focus();
      }

      // Home navigation buttons events
      navHomeBtn.addEventListener('click', () => {
        showPage('home');
      });
      navCategoryBtn.addEventListener('click', () => {
        openCategoryPage(categories[0].id);
      });
      navCartBtn.addEventListener('click', () => {
        openCartPage();
      });
      navLoginBtn.addEventListener('click', () => {
        openAuthPage('login');
      });

      // Home: category button clicks
      categoryButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const category = btn.dataset.category;
          if (category === 'tees'){
            openCategoryPage(category);
          } else {
            showToast('Category coming soon');
          }
        });
        btn.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            btn.click();
          }
        });
      });

      // Home: view products button click
      viewProductsBtn.addEventListener('click', () => {
        openCategoryPage(categories[0].id);
      });

      // Open Category Page for the first category only
      function openCategoryPage(categoryId){
        currentCategory = categories.find(cat => cat.id === categoryId);
        if (!currentCategory) return;

        categoryNameTitle.textContent = currentCategory.name;
        // Populate products grid
        productsGrid.innerHTML = '';
        currentCategory.products.forEach(product => {
          const card = document.createElement('button');
          card.className = 'bg-white rounded-lg shadow-md cursor-pointer hover:shadow-xl p-4 flex flex-col items-center focus:outline-none focus:ring-2 focus:ring-red-600';
          card.setAttribute('aria-label', `${product.title}, price ${formatPrice(product.price)}`);
          card.innerHTML = `
            <img src="${product.image}" alt="${product.title} product image, styled streetwear apparel" class="w-full h-auto rounded mb-4" onerror="this.onerror=null;this.src='https://placehold.co/200x200?text=Image+Unavailable';" />
            <span class="font-semibold mb-1">${product.title}</span>
            <span class="text-red-600 font-bold">${formatPrice(product.price)}</span>
          `;
          card.addEventListener('click', () => openProductPage(product.id));
          card.addEventListener('keydown', e => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              card.click();
            }
          });
          productsGrid.appendChild(card);
        });

        showPage('category');
      }

      // Category back button
      categoryBackBtn.addEventListener('click', () => {
        showPage('home');
      });

      // Open Product Page
      function openProductPage(productId){
        currentProduct = currentCategory.products.find(p => p.id === productId);
        if (!currentProduct) return;

        productImage.src = currentProduct.image;
        productImage.alt = `${currentProduct.title} product image, styled streetwear apparel`;
        productTitle.textContent = currentProduct.title;
        productDesc.textContent = currentProduct.description;
        productPrice.textContent = formatPrice(currentProduct.price);
        searchProductInput.value = '';
        searchEmptyMsg.classList.add('hidden');
        filteredVariants = [...currentProduct.tags];

        showPage('product');
      }

      // Product back button
      productBackBtn.addEventListener('click', () => {
        openCategoryPage(currentCategory.id);
      });

      // Search input on product page
      searchProductInput.addEventListener('input', (e) => {
        const query = e.target.value.trim().toLowerCase();
        if (!query) {
          // Show all tags as matching "variants"
          filteredVariants = [...currentProduct.tags];
          searchEmptyMsg.classList.add('hidden');
          return;
        }

        filteredVariants = currentProduct.tags.filter(tag => tag.includes(query));

        if (filteredVariants.length === 0) {
          searchEmptyMsg.textContent = 'No matching items found.';
          searchEmptyMsg.classList.remove('hidden');
        } else {
          searchEmptyMsg.classList.add('hidden');
        }
      });

      // Add to Cart
      addToCartBtn.addEventListener('click', () => {
        const existing = cart.find(item => item.product.id === currentProduct.id);
        if(existing){
          existing.quantity++;
        } else {
          cart.push({product: currentProduct, quantity: 1});
        }
        updateCartCount();
        showToast('Added to cart');
      });

      // Cart Page open
      function openCartPage(){
        renderCart();
        showPage('cart');
      }

      function renderCart(){
        cartList.innerHTML = '';
        let subtotal = 0;
        if(cart.length === 0){
          cartList.innerHTML = '<p class="text-gray-500 italic">Your cart is empty.</p>';
        } else {
          cart.forEach( (item, idx) => {
            subtotal += item.product.price * item.quantity;
            const cartItem = document.createElement('div');
            cartItem.className = 'flex items-center justify-between bg-white rounded shadow-sm p-3';

            cartItem.innerHTML = `
              <div class="flex items-center space-x-3 w-60">
                <img src="${item.product.image}" alt="${item.product.title} product image" class="w-16 h-16 rounded object-cover" onerror="this.onerror=null;this.src='https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/c00d583e-a536-4227-8999-01174d2a2dc4.png';" />
                <div>
                  <p class="font-semibold text-sm">${item.product.title}</p>
                  <p class="text-xs text-gray-600">${formatPrice(item.product.price)}</p>
                </div>
              </div>
              <div class="flex items-center space-x-2">
                <button aria-label="Decrease quantity" class="quantity-btn px-2 py-1 border rounded hover:bg-gray-100 focus:outline-none" data-action="dec" data-idx="${idx}">-</button>
                <span aria-live="polite" aria-atomic="true" class="font-semibold w-6 text-center">${item.quantity}</span>
                <button aria-label="Increase quantity" class="quantity-btn px-2 py-1 border rounded hover:bg-gray-100 focus:outline-none" data-action="inc" data-idx="${idx}">+</button>
              </div>
              <div>
                <p class="font-semibold">${formatPrice(item.product.price * item.quantity)}</p>
              </div>
            `;
            cartList.appendChild(cartItem);
          });
        }
        cartSubtotal.textContent = formatPrice(subtotal);
      }

      // Quantity adjust buttons in cart
      cartList.addEventListener('click', (e) => {
        if(e.target.classList.contains('quantity-btn')){
          const idx = +e.target.getAttribute('data-idx');
          const action = e.target.getAttribute('data-action');
          if(idx >= 0 && idx < cart.length){
            if(action === 'inc'){
              cart[idx].quantity++;
            } else if(action === 'dec'){
              cart[idx].quantity = Math.max(1, cart[idx].quantity -1);
            }
            renderCart();
            updateCartCount();
          }
        }
      });

      // Cart back button
      cartBackBtn.addEventListener('click', () => {
        showPage('home');
      });

      // Checkout button
      checkoutBtn.addEventListener('click', () => {
        showToast('Checkout flow not implemented.');
      });

      // Update cart count displayed in nav
      function updateCartCount(){
        const count = cart.reduce((acc, item) => acc + item.quantity, 0);
        cartCountEl.textContent = count;
        cartCountEl.style.display = count === 0 ? 'none' : 'inline-block';
      }
      updateCartCount(); // initialize

      // AUTHENTICATION Management

      function openAuthPage(tab = 'login'){
        showPage('auth');
        // Show proper tab & form
        selectAuthTab(tab);
      }

      function selectAuthTab(tab){
        // Tabs aria and visual
        [tabLogin, tabSignup, tabForgot].forEach(t => {
          t.setAttribute('aria-selected', 'false');
          t.classList.remove('border-red-600', 'font-semibold');
          t.classList.add('border-transparent');
        });

        // Hide all forms
        [loginPage, signupPage, forgotPasswordPage].forEach(f => f.classList.add('hidden'));

        // Show selected
        switch(tab){
          case 'login':
            tabLogin.setAttribute('aria-selected', 'true');
            tabLogin.classList.remove('border-transparent');
            tabLogin.classList.add('border-red-600', 'font-semibold');
            loginPage.classList.remove('hidden');
            break;
          case 'signup':
            tabSignup.setAttribute('aria-selected', 'true');
            tabSignup.classList.remove('border-transparent');
            tabSignup.classList.add('border-red-600', 'font-semibold');
            signupPage.classList.remove('hidden');
            break;
          case 'forgot':
            tabForgot.setAttribute('aria-selected', 'true');
            tabForgot.classList.remove('border-transparent');
            tabForgot.classList.add('border-red-600', 'font-semibold');
            forgotPasswordPage.classList.remove('hidden');
            resetPasswordForm.classList.add('hidden');
            otpForm.classList.add('hidden');
            forgotEmailForm.classList.remove('hidden');
            otpVerified = false;
            break;
        }
      }

      tabLogin.addEventListener('click', () => selectAuthTab('login'));
      tabSignup.addEventListener('click', () => selectAuthTab('signup'));
      tabForgot.addEventListener('click', () => selectAuthTab('forgot'));

      // Login form submit
      loginPage.addEventListener('submit', e => {
        e.preventDefault();
        const email = e.target.querySelector('#login-email').value.trim();
        const pass = e.target.querySelector('#login-password').value.trim();
        if(email && pass){
          showToast('Login successful (demo, no real auth)');
          showPage('home');
        }
      });

      // Signup form submit
      signupPage.addEventListener('submit', e => {
        e.preventDefault();
        const email = e.target.querySelector('#signup-email').value.trim();
        const pass1 = e.target.querySelector('#signup-password').value.trim();
        const pass2 = e.target.querySelector('#signup-password2').value.trim();
        if(email && pass1 && pass2){
          if(pass1 !== pass2){
            showToast('Passwords do not match');
            return;
          }
          showToast('Account created (demo, no real auth)');
          showPage('home');
        }
      });

      // Forgot Email Form: send OTP
      forgotEmailForm.addEventListener('submit', e => {
        e.preventDefault();
        userEmail = e.target.querySelector('#forgot-email').value.trim();
        if(userEmail){
          // Generate 6 digit OTP (simulate)
          userOtp = Math.floor(100000 + Math.random() * 900000).toString();
          // Show OTP form
          forgotEmailForm.classList.add('hidden');
          otpForm.classList.remove('hidden');
          showToast(`OTP sent to ${userEmail} (Simulated OTP: ${userOtp})`);
        }
      });

      // OTP form submit
      otpForm.addEventListener('submit', e => {
        e.preventDefault();
        const enteredOtp = e.target.querySelector('#otp-input').value.trim();
        if(enteredOtp === userOtp){
          otpVerified = true;
          otpForm.classList.add('hidden');
          resetPasswordForm.classList.remove('hidden');
          showToast('OTP verified. Please reset password.');
        } else {
          showToast('Invalid OTP. Please try again.');
        }
      });

      // Reset password form submit
      resetPasswordForm.addEventListener('submit', e => {
        e.preventDefault();
        if(!otpVerified){
          showToast('OTP verification required.');
          return;
        }
        const pw1 = e.target.querySelector('#new-password').value.trim();
        const pw2 = e.target.querySelector('#confirm-new-password').value.trim();
        if(pw1 && pw2){
          if(pw1 !== pw2){
            showToast('Passwords do not match.');
            return;
          }
          // Simulate password reset capture to Google Sheets (mock)
          showToast('Password reset successful. Data captured.');
          // Clear forms
          forgotEmailForm.querySelector('#forgot-email').value = '';
          otpForm.querySelector('#otp-input').value = '';
          resetPasswordForm.querySelector('#new-password').value = '';
          resetPasswordForm.querySelector('#confirm-new-password').value = '';
          userOtp = null;
          otpVerified = false;
          userEmail = null;
          openAuthPage('login');
        }
      });

      // Accessibility: Trap focus in modals if needed - skipped for simplicity

      // Initialize page on load
      showPage('home');
    })();
  </script>
</body>
</html>

